---
title: "AlphaRichness"
author: "Kaylee Arnold"
date: "10/8/2019" "Updated August 2022"
output: pdf_document
---

log transform all data

#Variable Names
```{r eval=FALSE, include=FALSE}
sample_variables(phyloseq_cleaned)
```

#Create labels
```{r}
# create labels for combined figures
library(grid)
figure_label_A <- grobTree(textGrob("(a)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_B <- grobTree(textGrob("(b)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_C <- grobTree(textGrob("(c)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_D <- grobTree(textGrob("(d)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))


figure_label_0.001 <- grobTree(textGrob("(p < 0.001)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_0.05 <- grobTree(textGrob("(p < 0.05)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_0.05.1 <- grobTree(textGrob("(p > 0.05)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_0.5.1 <- grobTree(textGrob("(p < 0.5)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))

figure_label_0.5 <- grobTree(textGrob("(p > 0.5)", x=0.05,  y=0.95, hjust=0,
  gp=gpar(col="black", fontsize=13)))
  
```

Test for normalcy in data -- need to move down. 
```{r}
set.seed(8765)
shapiro.test(alpha.diversity$Shannon)
shapiro.test(alpha.diversity$Simpson) 
shapiro.test(alpha.diversity$InvSimpson)
shapiro.test(alpha.diversity$Chao1)

```


Alpha Plots
New alpha diversity boxplot code from https://www.nicholas-ollberding.com/post/introduction-to-the-statistical-analysis-of-microbiome-data-in-r/

#All Samples
##Regions
###Figures
####Shannon
```{r}

adiv_regions_Shannon <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "Region" = phyloseq::sample_data(rpal_field)$Region)

adiv_regions_plot_Shannon <- adiv_regions_Shannon %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4.5) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 68)", "La Chorrera" = "La Chorrera\n(n = 115)", "Veraguas" = "Veraguas\n(n = 100)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Shannon Diversity", fill = "Regions",
       title = "Alpha Diversity Across Sampling Regions") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Shannon_plot <- adiv_regions_plot_Shannon +
  #capira:chorrera
  geom_line(data=tibble(x=c(2,3), y = c(2.6, 2.6)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.6)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.5, 2.6)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "*"), size = 4, # p < 0.04
            inherit.aes = FALSE) + 
  #veraguas:capira
  geom_line(data=tibble(x=c(1, 2), y = c(3.3, 3.3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(4, 4)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(4, 3.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(4, 3.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Obserevd
```{r}

adiv_regions_Observed <- data.frame(estimate_richness(rpal_field, measures = "Observed"),
                   "Region" = phyloseq::sample_data(rpal_field)$Region)

adiv_regions_plot_Observed <- adiv_regions_Observed %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 68)", "La Chorrera" = "La Chorrera\n(n = 115)", "Veraguas" = "Veraguas\n(n = 100)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Richness", fill = "Regions", 
       title = "ASV Richness") +
 # guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
Observed_plot <- adiv_regions_plot_Observed +
  #capira:chorrera
  geom_line(data=tibble(x=c(2,3), y = c(75, 75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(75, 73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(75, 73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(77)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "*"), size = 4, # p < 0.04
            inherit.aes = FALSE) + 
  #veraguas:capira
  geom_line(data=tibble(x=c(1, 2), y = c(80, 80)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(80, 78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(80, 78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(82)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(90, 90)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(90, 88)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(90, 88)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(92)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Faith's PD
```{r}

#FaithPD is already a data frame

adiv_regions_plot_FaithPD <- Faith_BM %>%
  ggplot(aes(x = Region, y = faith_pd, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,19) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 68)", "La Chorrera" = "La Chorrera\n(n = 115)", "Veraguas" = "Veraguas\n(n = 100)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Faith's Phylogenetic Diversity", fill = "Regions", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot <- adiv_regions_plot_FaithPD +
  #capira:chorrera
  geom_line(data=tibble(x=c(2,3), y = c(13, 13)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(13, 12.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(13, 12.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(14)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #veraguas:capira
  geom_line(data=tibble(x=c(1, 2), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(16.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(18, 18)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(18, 17.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(18, 17.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(18.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_regions_plot_Pielous_Evenness <- Pielous_Evenness %>%
  ggplot(aes(x = Region, y = pielou_evenness, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 68)", "La Chorrera" = "La Chorrera\n(n = 115)", "Veraguas" = "Veraguas\n(n = 100)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Pielou's Evenness", fill = "Regions", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Pielous_plot <- adiv_regions_plot_Pielous_Evenness +
  #capira:chorrera
  geom_line(data=tibble(x=c(2,3), y = c(.75, .75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.75, .73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.75, .73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.79)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #veraguas:capira
  geom_line(data=tibble(x=c(1, 2), y = c(.8, .8)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.8, .78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.8, .78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.84)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

###Combined plots
```{r}
grid.arrange(Observed_plot, Pielous_plot, Shannon_plot, FaithPD_plot)
```


###ANOVA
Stats information 
- Wilcoxon test (compares two groups - non parametric)
-kruskal wallis (compares multiple groups non parametric)


```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Observed
kruskal.test(Observed ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg


#Shannon 
kruskal.test(Shannon ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith 
kruskal.test(FaithPD$faith_pd ~ Region, FaithPD)

pairwise.wilcox.test(FaithPD$faith_pd, g = FaithPD$Region, p.adjust.method = "BH") #Benjamini & Hochberg


#Evenness 
kruskal.test(Pielous_Evenness$pielou_evenness ~ Region, Pielous_Evenness)

pairwise.wilcox.test(Pielous_Evenness$pielou_evenness, g = Pielous_Evenness$Region, p.adjust.method = "BH") #Benjamini & Hochberg


```

###Table
```{r}
library(gt)

n = 0
c_col = c("#1e3048", "#274060", "#2f5375", "#4073a0", "#5088b9")
c_col_light_blue = c("#edf2fb", "#e2eafc", "#d7e3fc", "#ccdbfd", "#c1d3fe")
c_container_width = px(800)
c_table_width = px(650)
c_rn = 13
c_save = TRUE
c_format = "html"


AlphaDiv_table_Region <- read_csv("/Volumes/GoogleDrive/Shared drives/Gottdenker Lab New/Kaylee/Chapter 2/Manuscript Drafts/Chapter 2/Tables/WorkInProgress/Alpha_Diversity/AlphaDiv_Region.csv")

AlphaDiv_table_Region <- na.omit(AlphaDiv_table_Region)

gt_table_Region <- AlphaDiv_table_Region %>%
 head(c_rn) %>%
  gt() %>% 
 cols_align(
  align = "left",
  columns = c("Alpha Diversity") 
 ) %>% 
 cols_width(
  c("Alpha Diversity") ~ px(150),
  c("Veraguas:LaChorrera") ~ px(180),
  c("Veraguas:Capira") ~ px(150),
  c("LaChorrera:Capira") ~ px(150),
 ) %>% 
 opt_row_striping()

gt_table_Region %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = c("Veraguas:LaChorrera"),
      rows = c("Veraguas:LaChorrera") > .05
    )
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = "LaChorrera:Capira",
      rows = "Faith's PD" > 5
    )
  ) %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = "Veraguas:Capira",
      rows = "Veraguas:Capira" > 5
    )
  ) %>% 
 cols_align(
  align = "right",
  columns = everything()
 ) %>%
  tab_header(
  title = "Alpha Diversity Across Regions",
  subtitle = "Kruskal Wallis p-values for 3 alpha diversity metrics"
 )


```

#Pasture palms
##Figures
###Observed
```{r}

adiv_pasture <- data.frame(estimate_richness(rpal_field_pasture, measures = "Observed"),
                   "Region" = phyloseq::sample_data(rpal_field_pasture)$Region)

adiv_pasture_observed_plot <- adiv_pasture %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + 
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Veraguas" = "Veraguas\n(n = 47)", "Capira" = "Capira\n(n = 54)", "La Chorrera" = "La Chorrera\n(n = 59)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Region', y = "Richness", fill = "Habitat Type", title = "ASV Richness (Pasture Palms)") +
  #guides(col = guide_legend("Habitat Type"))
  theme(legend.position = "none")


adiv_pasture_plot_observed <- adiv_pasture_observed_plot +
  #capira:chorrera
  geom_line(data=tibble(x=c(2,3), y = c(76, 76)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(76, 74)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(76, 74)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(80)), 
            aes(x=x, y=y, label = "*"), size = 4,
            inherit.aes = FALSE) + 
  #veraguas:Capira
  geom_line(data=tibble(x=c(1, 2), y = c(84, 84)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(84, 82)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(84, 82)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(88)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(92, 92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(92, 90)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(92, 90)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) 

```

####Shannon
```{r}
## need to change legend title and add sample sizes

adiv_pasture <- data.frame(estimate_richness(rpal_field_pasture, measures = "Shannon"),
                   "Region" = phyloseq::sample_data(rpal_field_pasture)$Region)

adiv_pasture_shannon_plot <- adiv_pasture %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4.3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
   scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Veraguas" = "Veraguas\n(n = 47)", "Capira" = "Capira\n(n = 54)", "La Chorrera" = "La Chorrera\n(n = 59)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Shannon Diversity", fill = "Habitat Type",
       title = "Shannon Diversity (Pasture Palms)") +
  #guides(col = guide_legend("Habitat Type"))
   theme(legend.position="none")

##update 
Shannon_plot_pasture <- adiv_pasture_shannon_plot +
  #Veraguas:Capira
  geom_line(data=tibble(x=c(1, 2), y = c(3.3, 3.3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.3, 3.2)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.3, 3.2)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "*"), size = 4,
            inherit.aes = FALSE) +
  #capira:la Chorrera
  geom_line(data=tibble(x=c(2, 3), y = c(2.8, 2.8)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.8, 2.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.8, 2.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(3)), 
            aes(x=x, y=y, label = "*"), size = 4, 
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(4, 4)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(4, 3.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(4, 3.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4.2)), 
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) 

```

####Faith's PD
```{r}

#FaithPD is already a data frame

adiv_FD_pasture <- FaithPD_Pasture %>%
  ggplot(aes(x = Region, y = faith_pd, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Veraguas" = "Veraguas\n(n = 47)", "Capira" = "Capira\n(n = 54)", "La Chorrera" = "La Chorrera\n(n = 59)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot_pasture_FD <- adiv_FD_pasture +
  #la chorrera:ver
  geom_line(data=tibble(x=c(2,3), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(18, 18)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(18, 17.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(18, 17.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(19)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(20, 20)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(20, 19.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(20, 19.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(21)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

####Pielou's Evenness
```{r}

#evenness is already a data frame

adiv_evenness_pasture <- Pielous_Evenness_Pasture %>%
  ggplot(aes(x = Region, y = pielou_evenness, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"), labels=c("Veraguas" = "Veraguas\n(n = 47)", "Capira" = "Capira\n(n = 54)", "La Chorrera" = "La Chorrera\n(n = 59)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Pielou's Evenness", fill = "Region", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
adiv_evenness_pasture_plot <- adiv_evenness_pasture +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(.75, .75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.75, .73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.75, .73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.79)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.82, .82)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.82, .8)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.82, .8)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.86)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #forest:peridomestic
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) 

```

###Combined plots (pasture and peridomestic)
```{r}
grid.arrange(adiv_pasture_plot_observed,Shannon_plot_pasture,adiv_peridomestic_plot_observed,adiv_peridomestic_plot_shannon)
```

###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_pasture_N4Adult, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_pasture_N4Adult), alpha.diversity)


#Observed
kruskal.test(Observed ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

#Shannon 
kruskal.test(Shannon ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

#Faith's PD
kruskal.test(FaithPD_Pasture$faith_pd ~ Region, FaithPD_Pasture)

pairwise.wilcox.test(FaithPD_Pasture$faith_pd, g = FaithPD_Pasture$Region, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness_Pasture$pielou_evenness ~ Region, Pielous_Evenness_Pasture)

pairwise.wilcox.test(Pielous_Evenness_Pasture$pielou_evenness, g = Pielous_Evenness_Pasture$Region, p.adjust.method = "BH")
```

##Blood meal
```{r}
adiv_BM_pasture <- data.frame(estimate_richness(rpal_field_BM_pasture, measures = "Observed"),
                   "FirstBM" = phyloseq::sample_data(rpal_field_BM_pasture)$FirstBM)

adiv_BM_plot_pasture_observed <- adiv_BM_pasture %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = FirstBM, y = value, fill = FirstBM)) +
  scale_fill_manual(values=bloodmeal_palette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Didelphis" = "Didelphis\n(n = 35)", "Heteromys" = "Heteromys\n(n = 62)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Veraguas Dominant Blood ID', y = "Richness", fill = "Habitat Type", title = "ASV Richness") +
  #guides(col = guide_legend("Habitat Type"))
  theme(legend.position = "none")
```


#Peridomestic
##Figures
###Observed
```{r}
adiv_peridomestic <- data.frame(estimate_richness(rpal_field_peridomestic, measures = "Observed"),
                   "Region" = phyloseq::sample_data(rpal_field_peridomestic)$Region)

adiv_peridomestic_observed_plot <- adiv_peridomestic %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"),labels=c("Capira" = "Capira\n(n = 14)", "La Chorrera" = "La Chorrera\n(n = 56)", "Veraguas" = "Veraguas\n(n = 29)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Richness", fill = "Region", title = "ASV Richness (Peridomestic Palms)") +
  #guides(col = guide_legend("Habitat Type"))
  theme(legend.position = "none")


## need to update for this figure
adiv_peridomestic_plot_observed <- adiv_peridomestic_observed_plot +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(65, 65)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(65, 63)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(65, 63)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(68)), 
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(75, 75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(75, 73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(75, 73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(78)), #text (4 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(92, 92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(92, 90)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(92, 90)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

###Shannon
```{r}
## need to change legend title and add sample sizes

adiv_peridomestic <- data.frame(estimate_richness(rpal_field_peridomestic, measures = "Shannon"),
                   "Region" = phyloseq::sample_data(rpal_field_peridomestic)$Region)

adiv_peridomestic_shannon_plot <- adiv_peridomestic %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Region, y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4.2) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"),labels=c("Capira" = "Capira\n(n = 14)", "La Chorrera" = "La Chorrera\n(n = 56)", "Veraguas" = "Veraguas\n(n = 29)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Shannon Diversity", fill = "Habitat Type",
       title = "Shannon Diversity (Peridomestic Palms)") +
  #guides(col = guide_legend("Habitat Type"))
   theme(legend.position="none")

##update 
adiv_peridomestic_plot_shannon <- adiv_peridomestic_shannon_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3, 3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3, 2.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3, 2.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.3)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(2.5, 2.5)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.5, 2.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(2.8)), 
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(4, 4)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(4, 3.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(4, 3.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4.2)), 
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) 

```

###Faith's PD
```{r}

#FaithPD is already a data frame

adiv_FD_peridomestic <- FaithPD_Peridomestic %>%
  ggplot(aes(x = Region, y = faith_pd, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"),labels=c("Capira" = "Capira\n(n = 14)", "La Chorrera" = "La Chorrera\n(n = 56)", "Veraguas" = "Veraguas\n(n = 29)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
adiv_FD_peridomestic_plot <- adiv_FD_peridomestic +
  #cperidomestic:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(14, 14)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(14, 13.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(14, 13.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(15)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(20, 20)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(20, 19.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(20, 19.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(21)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

###Pielou's Evenness
```{r}

#evenness is already a data frame

adiv_evenness_peridomestic <- Pielous_Evenness_Peridomestic %>%
  ggplot(aes(x = Region, y = pielou_evenness, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Veraguas", "Capira", "La Chorrera"),labels=c("Capira" = "Capira\n(n = 14)", "La Chorrera" = "La Chorrera\n(n = 56)", "Veraguas" = "Veraguas\n(n = 29)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Regions', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
adiv_evenness_peridomestic_plot <- adiv_evenness_peridomestic +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(.74, .74)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.74, .72)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.74, .72)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.78)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.82, .82)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.82, .8)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.82, .8)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.86)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #forest:peridomestic
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) 

```

###Combined plots
```{r}
grid.arrange(adiv_peridomestic_plot_observed,adiv_evenness_peridomestic_plot,adiv_peridomestic_plot_shannon,adiv_FD_peridomestic_plot)
```

###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_peridomestic_N4Adult, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_peridomestic_N4Adult), alpha.diversity)


#Observed
kruskal.test(Observed ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

#Shannon 
kruskal.test(Shannon ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

#Faith's PD
kruskal.test(FaithPD_Peridomestic$faith_pd ~ Region, FaithPD_Peridomestic)

pairwise.wilcox.test(FaithPD_Peridomestic$faith_pd, g = FaithPD_Peridomestic$Region, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness_Peridomestic$pielou_evenness ~ Region, Pielous_Evenness_Peridomestic)

pairwise.wilcox.test(Pielous_Evenness_Peridomestic$pielou_evenness, g = Pielous_Evenness_Peridomestic$Region, p.adjust.method = "BH")
```



##Habitat Type 
Alpha Richness (Shannon) - all field samples across habitat (rpal_field)
This figure shows there is difference between forest, but not between pasture and peridomestic
###Figures
####Shannon
```{r}
## need to change legend title and add sample sizes

adiv_habitat_Shannon <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field)$HABITAT)

adiv_habitat_plot_Shannon <- adiv_habitat_Shannon %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 160)", "Peridomestic" = "Peridomestic\n(n = 99)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type",
       title = "Shannon Diversity") +
  #guides(col = guide_legend("Habitat Type"))
   theme(legend.position="none")


Shannon_plot_habitat <- adiv_habitat_plot_Shannon +
  geom_line(data=tibble(x=c(1, 2), y = c(3, 3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.9, 3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.9, 3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4, # p < 0.05
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(2.7, 2.7)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.6, 2.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.6, 2.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(2.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.5, 3.5)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.5, 3.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.5, 3.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```


####Obserevd
```{r}

adiv_habitat_Observed <- data.frame(estimate_richness(rpal_field, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field)$HABITAT)

adiv_habitat_plot_Observed <- adiv_habitat_Observed %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 160)", "Peridomestic" = "Peridomestic\n(n = 99)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Richness", fill = "HABITAT", 
       title = "ASV Richness") +
 # guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
Observed_plot_habitat <- adiv_habitat_plot_Observed +
  #pasture:peridoemstic
  geom_line(data=tibble(x=c(2,3), y = c(75, 75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(75, 73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(75, 73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(77)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "*"), size = 4, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(80, 80)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(80, 78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(80, 78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(82)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(90, 90)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(90, 88)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(90, 88)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(92)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Faith's PD
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_FaithPD <- FaithPD %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 160)", "Peridomestic" = "Peridomestic\n(n = 99)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot_habitat <- adiv_habitat_plot_FaithPD +
  #cpasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(18, 18)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(18, 17.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(18, 17.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(18.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(20, 20)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(20, 19.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(20, 19.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(20.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_Pielous_Evenness <- Pielous_Evenness %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 160)", "Peridomestic" = "Peridomestic\n(n = 99)", "Forest" = "Forest\n(n = 24)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Pielous_plot_habitat <- adiv_habitat_plot_Pielous_Evenness +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(.75, .75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.75, .73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.75, .73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.79)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.8, .8)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.8, .78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.8, .78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.82)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #forest:peridomestic
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.94)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

###Combined plots
```{r}
grid.arrange(Observed_plot_habitat, Pielous_plot_habitat, Shannon_plot_habitat, FaithPD_plot_habitat)
```

###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(FaithPD$faith_pd ~ HABITAT, FaithPD)

pairwise.wilcox.test(FaithPD$faith_pd, g = FaithPD$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous$pielou_evenness ~ HABITAT, Pielous_Evenness)

pairwise.wilcox.test(Pielous_Evenness$pielou_evenness, g = Pielous_Evenness$Region, p.adjust.method = "BH")
```

###Table
```{r}

n = 0
c_col = c("#1e3048", "#274060", "#2f5375", "#4073a0", "#5088b9")
c_col_light_blue = c("#edf2fb", "#e2eafc", "#d7e3fc", "#ccdbfd", "#c1d3fe")
c_container_width = px(800)
c_table_width = px(650)
c_rn = 13
c_save = TRUE
c_format = "html"

AlphaDiv_table_Habitat <- read_csv("/Volumes/GoogleDrive/Shared drives/Gottdenker Lab New/Kaylee/Chapter 2/Manuscript Drafts/Chapter 2/Tables/WorkInProgress/Alpha_Diversity/AlphaDiv_Habitat.csv")

AlphaDiv_table_Habitat <- na.omit(AlphaDiv_table_Habitat)

gt_table_Habitat <- AlphaDiv_table_Habitat %>%
 head(c_rn) %>%
  gt()


gt_table_Habitat %>% 
 cols_width(
  c("Alpha Diversity") ~ px(150),
  c("Pasture:Peridomestic") ~ px(200),
  c("Forest:Pasture") ~ px(200),
  c("Forest:Peridomestic") ~ px(200),
 ) %>% 
 opt_row_striping()
  
gt_table_Habitat %>%
tab_style(
    style = list(
      #cell_fill(color = "lightcyan"),
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = c("Forest:Peridomestic"),
      rows = c("Forest:Peridomestic") > 0.05
    )
) %>%
tab_style(
    style = list(
      #cell_fill(color = "lightcyan"),
      cell_text(weight = "bold")
      ),
    locations = cells_body(
      columns = c("Forest:Pasture"),
      rows = c("Forest:Pasture") > 0.05
    )
)  %>% 
  tab_header(
  title = "Alpha Diversity across Habitat Types",
  subtitle = "Kruskal Wallis p-values for 3 alpha diversity metrics"
 )
```

#Capira
##Habitat
###Shannon
The anova shows sig differences between pasture and peridomestic
```{r}
adiv_habitat_capira_shannon <- data.frame(estimate_richness(rpal_field_capira, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_capira)$HABITAT)

adiv_habitat_plot_shannon_capira <- adiv_habitat_capira_shannon %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 54)", "Peridomestic" = "Peridomestic\n(n = 14)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type", 
       title = "Shannon Diversity (Capira Palms)") +
  theme(legend.position = "none")


Shannon_plot_habitat_capira <- adiv_habitat_plot_shannon_capira +
  geom_line(data=tibble(x=c(1, 2), y = c(2.5, 2.5)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.5, 2.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.05
            inherit.aes = FALSE) 
```

###Obserevd
```{r}

adiv_habitat_Observed_Capira <- data.frame(estimate_richness(rpal_field_capira, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_capira)$HABITAT)

adiv_habitat_plot_Observed_capira <- adiv_habitat_Observed_Capira %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,80) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 54)", "Peridomestic" = "Peridomestic\n(n = 14)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Richness", fill = "HABITAT", 
       title = "ASV Richness (Capira Palms)") +
 # guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
Observed_plot_habitat_capira <- adiv_habitat_plot_Observed_capira +
  geom_line(data=tibble(x=c(1, 2), y = c(72, 72)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(72, 70)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(72, 70)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(75)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) 

```

###Faith's PD
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_FaithPD_Capira <- FaithPD_Capira %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 54)", "Peridomestic" = "Peridomestic\n(n = 14)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot_habitat_capira <- adiv_habitat_plot_FaithPD_Capira +
  geom_line(data=tibble(x=c(1, 2), y = c(19, 19)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(19, 18.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(19, 18.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(20)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE)
  
```

###Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_Pielous_Evenness_Capira <- Pielous_Evenness_Capira %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2"))  +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 54)", "Peridomestic" = "Peridomestic\n(n = 14)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Pielous_plot_habitat_capira <- adiv_habitat_plot_Pielous_Evenness_Capira +
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.8, .8)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.8, .78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.8, .78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.84)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) # < 0.0001

```

###Combined plots (Capira and Chorrera)
```{r}
grid.arrange(Observed_plot_habitat_capira, Shannon_plot_habitat_capira, adiv_habitat_plot_Observed_chorrera, adiv_habitat_plot_shannon_chorrera)

```

##ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_capira, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_capira), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg

#Faith's PD

kruskal.test(FaithPD_Capira$faith_pd ~ HABITAT, FaithPD_Capira)

pairwise.wilcox.test(FaithPD_Capira$faith_pd, g = FaithPD_Capira$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness_Capira$pielou_evenness ~ HABITAT, Pielous_Evenness_Capira)

pairwise.wilcox.test(Pielous_Evenness_Capira$pielou_evenness, g = Pielous_Evenness_Capira$HABITAT, p.adjust.method = "BH")

#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
HABITAT.KW.InvSimpson <- kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg
```


##NumberBM
```{r}
adiv_habitat_capira_shannon_NumberBM <- data.frame(estimate_richness(rpal_field_BM_Capira, measures = "Shannon"),
                   "NumberBM" = phyloseq::sample_data(rpal_field_BM_Capira)$NumberBM)

adiv_habitat_plot_shannon_capira_BM <- adiv_habitat_capira_shannon_NumberBM %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = NumberBM, y = value, fill = NumberBM)) +
  #scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  #scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 54)", "Peridomestic" = "Peridomestic\n(n = 14)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type", 
       title = "Shannon Diversity") +
  theme(legend.position = "none")
```

#Chorrera
##Habitat
###Shannon
```{r}
## need to change legend title and add sample sizes

adiv_habitat <- data.frame(estimate_richness(rpal_field_laChorrera, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_laChorrera)$HABITAT)

adiv_habitat_plot_shannon_chorrera <- adiv_habitat %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.8) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 59)", "Peridomestic" = "Peridomestic\n(n = 56)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", title = "Shannon Diversity (La Chorrera Palms)") +
  guides(col = guide_legend("Habitat Type")) +
  theme(legend.position="none")
  


adiv_habitat_plot_shannon_chorrera <- adiv_habitat_plot_shannon_chorrera +
  geom_line(data=tibble(x=c(1, 2), y = c(2.6, 2.6)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.6, 2.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.6, 2.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.05
            inherit.aes = FALSE) 

```

###Obserevd
```{r}

adiv_habitat_Observed_Chorrera <- data.frame(estimate_richness(rpal_field_laChorrera, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_laChorrera)$HABITAT)

adiv_habitat_plot_Observed_chorrera <- adiv_habitat_Observed_Chorrera %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,80) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 59)", "Peridomestic" = "Peridomestic\n(n = 56)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Richness", fill = "HABITAT", 
       title = "ASV Richness (La Chorrera Palms") +
 # guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
adiv_habitat_plot_Observed_chorrera <- adiv_habitat_plot_Observed_chorrera +
  geom_line(data=tibble(x=c(1, 2), y = c(72, 72)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(72, 70)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(72, 70)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(75)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) 

```

###Faith's PD
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_FaithPD_Chorrera <- FaithPD_Chorrera %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 59)", "Peridomestic" = "Peridomestic\n(n = 56)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot_habitat_chorrera <- adiv_habitat_plot_FaithPD_Chorrera +
  geom_line(data=tibble(x=c(1, 2), y = c(15, 15)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(15, 14)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(15, 14)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE)
  
```

###Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_Pielous_Evenness_Chorrera <- Pielous_Evenness_Chorrera %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values= c("#E69F00", "#0072B2"))  +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 59)", "Peridomestic" = "Peridomestic\n(n = 56)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Pielous_plot_habitat_chorrera <- adiv_habitat_plot_Pielous_Evenness_Chorrera +
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.8, .8)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.8, .78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.8, .78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) # < 0.0001

```

###Combined plots
```{r}
grid.arrange(adiv_habitat_plot_Observed_chorrera,Pielous_plot_habitat_chorrera,adiv_habitat_plot_shannon_chorrera,FaithPD_plot_habitat_chorrera)
```


####ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_laChorrera, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_laChorrera), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg ### no differences between any habitat types


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg

#Faith PD
kruskal.test(FaithPD_Chorrera$faith_pd ~ FaithPD_Chorrera$HABITAT, FaithPD_Chorrera)

pairwise.wilcox.test(FaithPD_Chorrera$faith_pd, g = FaithPD_Chorrera$HABITAT, p.adjust.method = "BH")

#Pielous Evenness
kruskal.test(Pielous_Evenness_Chorrera$pielou_evenness ~ Pielous_Evenness_Chorrera$HABITAT, Pielous_Evenness_Chorrera)

pairwise.wilcox.test(Pielous_Evenness_Chorrera$pielou_evenness, g = Pielous_Evenness_Chorrera$HABITAT, p.adjust.method = "BH")

#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
HABITAT.KW.InvSimpson <- kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg
```




#Veraguas
##Habitat
###Figures
####Observed
```{r}
## need to change legend title and add sample sizes

adiv_habitat_Veraguas <- data.frame(estimate_richness(rpal_field_veraguas, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_veraguas)$HABITAT)

adiv_habitat_plot_veraguas_observed <- adiv_habitat_Veraguas %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 47)", "Peridomestic" = "Peridomestic\n(n = 29)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Richness", fill = "Habitat Type", title = "ASV Richness") +
  #guides(col = guide_legend("Habitat Type"))
  theme(legend.position = "none")


adiv_habitat_plot_veraguas_observed_plot <- adiv_habitat_plot_veraguas_observed +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(80, 80)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(80, 78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(80, 78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(84)), 
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(84, 84)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(84, 82)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(84, 82)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(88)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(92, 92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(92, 90)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(92, 90)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(96)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

####Shannon
```{r}
## need to change legend title and add sample sizes

adiv_habitat_Shannon_Veraguas <- data.frame(estimate_richness(rpal_field_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_veraguas)$HABITAT)

adiv_habitat_plot_Shannon_veraguas <- adiv_habitat_Shannon_Veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4.3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 47)", "Peridomestic" = "Peridomestic\n(n = 29)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", title = "Alpha Diversity Across Veraguas") +
  #guides(col = guide_legend("Habitat Type"))
   theme(legend.position="none")


Shannon_plot_habitat_veraguas <- adiv_habitat_plot_Shannon_veraguas +
  geom_line(data=tibble(x=c(1, 2), y = c(3.5, 3.5)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.5, 3.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.5, 3.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3.3, 3.3)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.3, 3.2)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.3, 3.2)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(3.6)), 
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(4, 4)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(4, 3.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(4, 3.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4.2)), 
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) 

```

####Faith's PD
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_FaithPD_veraguas <- FaithPD_Veraguas %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 47)", "Peridomestic" = "Peridomestic\n(n = 29)", "Forest" = "Forest\n(n = 24)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
FaithPD_plot_habitat_veraguas <- adiv_habitat_plot_FaithPD_veraguas +
  #cpasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(18, 18)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(18, 17.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(18, 17.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(19)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(20, 20)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(20, 19.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(20, 19.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(21)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

####Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_habitat_plot_Pielous_Evenness_Veraguas <- Pielous_Evenness_Veraguas %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture\n(n = 47)", "Peridomestic" = "Peridomestic\n(n = 29)", "Forest" = "Forest\n(n = 24)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
Pielous_plot_habitat_veraguas <- adiv_habitat_plot_Pielous_Evenness_Veraguas +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(.78, .78)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.78, .76)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.78, .76)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.82)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.82, .82)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.82, .8)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.82, .8)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.84)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  #forest:peridomestic
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.94)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) 

```

###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_veraguas, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_veraguas), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg ### no differences between any habitat types


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(FaithPD_Veraguas$faith_pd ~ HABITAT, FaithPD_Veraguas)

pairwise.wilcox.test(FaithPD_Veraguas$faith_pd, g = FaithPD_Veraguas$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness_Veraguas$pielou_evenness ~ HABITAT, Pielous_Evenness_Veraguas)

pairwise.wilcox.test(Pielous_Evenness_Veraguas$pielou_evenness, g = Pielous_Evenness_Veraguas$HABITAT, p.adjust.method = "BH")

#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
HABITAT.KW.InvSimpson <- kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg
```

###Combined plots
```{r}
grid.arrange(adiv_habitat_plot_veraguas_observed_plot, Pielous_plot_habitat_veraguas, Shannon_plot_habitat_veraguas, FaithPD_plot_habitat_veraguas)
```


##Blood meal
###Figures
####Observed
```{r}
## need to change legend title and add sample sizes

adiv_BM <- data.frame(estimate_richness(rpal_field_BM_Dominant, measures = "Observed"),
                   "FirstBM" = phyloseq::sample_data(rpal_field_BM_Dominant)$FirstBM)

adiv_BM_plot_observed <- adiv_BM %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = FirstBM, y = value, fill = FirstBM)) +
  scale_fill_manual(values=bloodmeal_palette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,120) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Didelphis" = "Didelphis\n(n = 35)", "Heteromys" = "Heteromys\n(n = 62)", "Philander" = "Philander\n(n = 70)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = ' Dominant blood meal', y = "Richness", title = "ASV Richness") +
  #guides(col = guide_legend("Habitat Type"))
  theme(legend.position = "none")


adiv_BM_plot_observed <- adiv_BM_plot_observed +
  geom_line(data=tibble(x=c(1, 2), y = c(85, 85)), #horizontal line 1-2
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(85, 82)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(85, 82)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(92)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(75, 75)), #horizontal line 2-3
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(75, 72)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(75, 72)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(80)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(100, 100)), #horizontal line 1-3
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(100, 97)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(100, 97)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(105)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE)


```

####Shannon
```{r}
## need to change legend title and add sample sizes

adiv_Shannon_BM <- data.frame(estimate_richness(rpal_field_BM_Dominant, measures = "Shannon"),
                   "FirstBM" = phyloseq::sample_data(rpal_field_BM_Dominant)$FirstBM)

adiv_plot_Shannon_BM <- adiv_Shannon_BM %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = FirstBM, y = value, fill = FirstBM)) +
  scale_fill_manual(values=bloodmeal_palette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4.3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Didelphis" = "Didelphis\n(n = 35)", "Heteromys" = "Heteromys\n(n = 62)", "Philander" = "Philander\n(n = 70)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Dominant blood meal', y = "Shannon Diversity",
       title = "Shannon Diversity") +
   theme(legend.position="none")


adiv_plot_Shannon_BM <- adiv_plot_Shannon_BM +
  geom_line(data=tibble(x=c(1, 2), y = c(3.5, 3.5)), #horizontal line 1-2
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.5, 3.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.5, 3.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3, 3)), #horizontal line 2-3
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3, 2.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3, 2.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(3.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) + 
  geom_line(data=tibble(x=c(1, 3), y = c(4, 4)), #horizontal line 1-3
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(4, 3.9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(4, 3.9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE)

```

####Faith's PD
```{r}

#FaithPD is already a data frame

adiv_BM_plot_FaithPD <- Faith_Dominant %>%
  ggplot(aes(x = FirstBM, y = faith_pd, fill = FirstBM)) +
  scale_fill_manual(values=bloodmeal_palette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,23) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Didelphis" = "Didelphis\n(n = 35)", "Heteromys" = "Heteromys\n(n = 62)", "Philander" = "Philadner\n(n = 70)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Dominant blood meal', y = "Faith's Phylogenetic Diversity", title = "Faith's Phylogenetic Diversity") +
  #guides(col = guide_legend("Regions"))
  theme(legend.position="none")

#add sig figures and lines
adiv_BM_plot_FaithPD <- adiv_BM_plot_FaithPD +
  #pasture:peridomestic
  geom_line(data=tibble(x=c(2,3), y = c(16, 16)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(16, 15.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(16, 15.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(17)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, # p < 0.04
            inherit.aes = FALSE) + 
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(18, 18)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(18, 17.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(18, 17.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(19)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4, 
            inherit.aes = FALSE) + 
  #chorrera:veraguas
  geom_line(data=tibble(x=c(1, 3), y = c(20, 20)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(20, 19.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(20, 19.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(21)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) # < 0.0001

```

####Pielou's Evenness
```{r}

#FaithPD is already a data frame

adiv_BM_plot_Pielous_Evenness <- Pielous_Dominant %>%
  ggplot(aes(x = FirstBM, y = pielou_evenness, fill = FirstBM)) +
  scale_fill_manual(values=bloodmeal_palette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Didelphis" = "Didelphis\n(n = 35)", "Heteromys" = "Heteromys\n(n = 62)", "Philander" = "Philander\n(n = 70)"))  + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Dominant blood meal', y = "Pielou's Evenness", fill = "Habitat Type", 
       title = "Pielou's Evenness") +
  #guides(col = guide_legend("Regions")) +
  theme(legend.position="none")

#add sig figures and lines
adiv_BM_plot_Pielous_Evenness <- adiv_BM_plot_Pielous_Evenness +
  geom_line(data=tibble(x=c(2,3), y = c(.73, .73)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.73, .71)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.73, .71)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(.77)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 4,
            inherit.aes = FALSE) + 
  geom_line(data=tibble(x=c(1, 2), y = c(.82, .82)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.82, .8)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.82, .8)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.84)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) + 
  geom_line(data=tibble(x=c(1, 3), y = c(.92, .92)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.92, .9)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(.92, .9)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.94)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4,
            inherit.aes = FALSE) 

```

###Combined figures
```{r}
grid.arrange(adiv_BM_plot_observed, adiv_BM_plot_Pielous_Evenness, adiv_plot_Shannon_BM, adiv_BM_plot_FaithPD)
```


###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field_BM_Dominant, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_BM_Dominant), alpha.diversity)


#Observed
kruskal.test(Observed ~ FirstBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$FirstBM, p.adjust.method = "BH") #Benjamini & Hochberg ### no differences between any blood meals


#Shannon 
kruskal.test(Shannon ~ FirstBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$FirstBM, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(Faith_Dominant$faith_pd ~ FirstBM, Faith_Dominant)

pairwise.wilcox.test(Faith_Dominant$faith_pd, g = Faith_Dominant$FirstBM, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Dominant$pielou_evenness ~ FirstBM, Pielous_Dominant)

pairwise.wilcox.test(Pielous_Dominant$pielou_evenness, g = Pielous_Dominant$FirstBM, p.adjust.method = "BH")

```


#Didelphis
##Figures
###Observed
```{r}

adiv_Didelphis <- data.frame(estimate_richness(rpal_field_Didelphis, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Didelphis)$HABITAT)


adiv_Didelphis_plot <- adiv_Didelphis %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 11)", "Pasture" = "Pasture\n(n = 9)", "Peridomestic" = "Peridomestic\n(n = 15)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "ASV Richness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

## create label for p value


adiv_Didelphis_plot <- adiv_Didelphis_plot + annotation_custom(figure_label_0.001)



#add sig figs

adiv_BM_plot +
  geom_text(data=tibble(x=c(1), y = 3.2), 
            aes(x=x, y=y, label = "a"), size = 3, #didelphis
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.2)), 
            aes(x=x, y=y, label = "b"), size = 3, #heteromy
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(3.2)), 
            aes(x=x, y=y, label = "c"), size = 3, #human
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(4), y = c(3.2)), 
            aes(x=x, y=y, label = "c,d,e"), size = 3, #mus
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(5), y = c(3.2)), 
            aes(x=x, y=y, label = "b,c,d,f"), size = 3, #piranga
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(6), y = c(3.2)), 
            aes(x=x, y=y, label = "e,f"), size = 3, #philander
            inherit.aes = FALSE) 

```

###Shannon
```{r}

adiv_Didelphis <- data.frame(estimate_richness(rpal_field_Didelphis, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Didelphis)$HABITAT)


adiv_Didelphis_plot_shannon <- adiv_Didelphis %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,5) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 11)", "Pasture" = "Pasture\n(n = 9)", "Peridomestic" = "Peridomestic\n(n = 15)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_Didelphis_plot_shannon <- adiv_Didelphis_plot_shannon + annotation_custom(figure_label_0.001)
```

###Faith PD
```{r}

adiv_Didelphis_plot_Faith <- Didelphis_Faith %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,20) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 11)", "Pasture" = "Pasture\n(n = 9)", "Peridomestic" = "Peridomestic\n(n = 15)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_Didelphis_plot_Faith <- adiv_Didelphis_plot_Faith + annotation_custom(figure_label_0.05.1)
```

###Evenness
```{r}
adiv_Didelphis_plot_pielou <- Didelphis_Pielou %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 11)", "Pasture" = "Pasture\n(n = 9)", "Peridomestic" = "Peridomestic\n(n = 15)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")



adiv_Didelphis_plot_pielou <- adiv_Didelphis_plot_pielou + annotation_custom(figure_label_0.001)
```

##Combined plots
```{r}
grid.arrange(adiv_Didelphis_plot,adiv_Didelphis_plot_pielou,adiv_Didelphis_plot_shannon,adiv_Didelphis_plot_Faith)
```


##ANOVA
```{r}
alpha.diversity <- estimate_richness(rpal_field_Didelphis, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_Didelphis), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(Didelphis_Faith$faith_pd ~ HABITAT, Didelphis_Faith)

pairwise.wilcox.test(Didelphis_Faith$faith_pd, g = Didelphis_Faith$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Didelphis_Pielou$pielou_evenness ~ HABITAT, Didelphis_Pielou)

pairwise.wilcox.test(Didelphis_Pielou$pielou_evenness, g = Didelphis_Pielou$HABITAT, p.adjust.method = "BH")

```

#Heteromys
##Figures
####Obsereved
```{r}

adiv_heteromys <- data.frame(estimate_richness(rpal_field_Heteromys, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Heteromys)$HABITAT)


adiv_heteromys_plot <- adiv_heteromys %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 13)", "Pasture" = "Pasture\n(n = 38)", "Peridomestic" = "Peridomestic\n(n = 11)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "ASV Richness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")


adiv_heteromys_plot <- adiv_heteromys_plot + annotation_custom(figure_label_0.05.1)

#add sig figs

adiv_BM_plot +
  geom_text(data=tibble(x=c(1), y = 3.2), 
            aes(x=x, y=y, label = "a"), size = 3, #didelphis
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.2)), 
            aes(x=x, y=y, label = "b"), size = 3, #heteromy
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(3.2)), 
            aes(x=x, y=y, label = "c"), size = 3, #human
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(4), y = c(3.2)), 
            aes(x=x, y=y, label = "c,d,e"), size = 3, #mus
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(5), y = c(3.2)), 
            aes(x=x, y=y, label = "b,c,d,f"), size = 3, #piranga
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(6), y = c(3.2)), 
            aes(x=x, y=y, label = "e,f"), size = 3, #philander
            inherit.aes = FALSE) 

```

####Shannon
```{r}

adiv_heteromys <- data.frame(estimate_richness(rpal_field_Heteromys, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Heteromys)$HABITAT)


adiv_heteromys_plot_shannon <- adiv_heteromys %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 13)", "Pasture" = "Pasture\n(n = 38)", "Peridomestic" = "Peridomestic\n(n = 11)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_heteromys_plot_shannon <- adiv_heteromys_plot_shannon + annotation_custom(figure_label_0.05)
```

####Faith PD
```{r}

adiv_heteromys_plot_Faith <- Heteromys_Faith %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,20) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 13)", "Pasture" = "Pasture\n(n = 38)", "Peridomestic" = "Peridomestic\n(n = 11)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Faith's Phylogenetic Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_heteromys_plot_Faith <- adiv_heteromys_plot_Faith + annotation_custom(figure_label_0.05)
```

####Evenness
```{r}
adiv_heteromys_plot_pielou <- Heteromys_Pielou %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Forest", "Pasture", "Peridomestic"), labels=c("Forest" = "Forest\n(n = 11)", "Pasture" = "Pasture\n(n = 9)", "Peridomestic" = "Peridomestic\n(n = 15)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_heteromys_plot_pielou <- adiv_heteromys_plot_pielou + annotation_custom(figure_label_0.05)
```

##Combined Plots
```{r}
grid.arrange(adiv_heteromys_plot,adiv_heteromys_plot_pielou,adiv_heteromys_plot_shannon,adiv_heteromys_plot_Faith)
```


###ANOVA
```{r}
alpha.diversity <- estimate_richness(rpal_field_Heteromys, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_Heteromys), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(Heteromys_Faith$faith_pd ~ HABITAT, Heteromys_Faith)

pairwise.wilcox.test(Heteromys_Faith$faith_pd, g = Heteromys_Faith$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Heteromys_Pielou$pielou_evenness ~ HABITAT, Heteromys_Pielou)

pairwise.wilcox.test(Heteromys_Pielou$pielou_evenness, g = Heteromys_Pielou$HABITAT, p.adjust.method = "BH")

```

#Philander
##Habitat
###Figures
####Observed
```{r}

adiv_philander <- data.frame(estimate_richness(rpal_field_Philander, measures = "Observed"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Philander)$HABITAT)


adiv_philander_plot <- adiv_philander %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,80) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Pasture", "Peridomestic"), labels=c("Pasture" = "Pasture\n(n = 35)", "Peridomestic" = "Peridomestic\n(n = 34)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "ASV Richness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot <- adiv_philander_plot + annotation_custom(figure_label_0.5)

#add sig figs

adiv_BM_plot +
  geom_text(data=tibble(x=c(1), y = 3.2), 
            aes(x=x, y=y, label = "a"), size = 3, #didelphis
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.2)), 
            aes(x=x, y=y, label = "b"), size = 3, #heteromy
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(3.2)), 
            aes(x=x, y=y, label = "c"), size = 3, #human
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(4), y = c(3.2)), 
            aes(x=x, y=y, label = "c,d,e"), size = 3, #mus
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(5), y = c(3.2)), 
            aes(x=x, y=y, label = "b,c,d,f"), size = 3, #piranga
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(6), y = c(3.2)), 
            aes(x=x, y=y, label = "e,f"), size = 3, #philander
            inherit.aes = FALSE) 

```

####Shannon
```{r}

adiv_philander <- data.frame(estimate_richness(rpal_field_Philander, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_Philander)$HABITAT)


adiv_philander_plot_shannon <- adiv_philander %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = reorder(HABITAT, -value), y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,2.5) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Pasture", "Peridomestic"), labels=c("Pasture" = "Pasture\n(n = 35)", "Peridomestic" = "Peridomestic\n(n = 34)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Shannon Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_shannon <- adiv_philander_plot_shannon + annotation_custom(figure_label_0.05.1)
```

####Faith PD
```{r}

adiv_philander_plot_Faith <- Philander_Faith %>%
  ggplot(aes(x = HABITAT, y = faith_pd, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,13) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Pasture", "Peridomestic"), labels=c("Pasture" = "Pasture\n(n = 35)", "Peridomestic" = "Peridomestic\n(n = 34)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = "Habitat Type", y = "Faith's Phylogenetic Diversity", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_Faith <- adiv_philander_plot_Faith + annotation_custom(figure_label_0.5)
```

####Evenness
```{r}
adiv_philander_plot_pielou <- Philander_Pielou %>%
  ggplot(aes(x = HABITAT, y = pielou_evenness, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Pasture", "Peridomestic"), labels=c("Pasture" = "Pasture\n(n = 35)", "Peridomestic" = "Peridomestic\n(n = 34)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Habitat Type', y = "Pielou's Evenness", fill = "Habitat Type") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_pielou <- adiv_philander_plot_pielou + annotation_custom(figure_label_0.05.1)
```

##Combined Plots
```{r}
grid.arrange(adiv_philander_plot,adiv_philander_plot_pielou,adiv_philander_plot_shannon,adiv_philander_plot_Faith)
```


###ANOVA
```{r}
alpha.diversity <- estimate_richness(rpal_field_Philander, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_Philander), alpha.diversity)


#Observed
kruskal.test(Observed ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(Philander_Faith$faith_pd ~ HABITAT, Philander_Faith)

pairwise.wilcox.test(Philander_Faith$faith_pd, g = Philander_Faith$HABITAT, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Philander_Pielou$pielou_evenness ~ HABITAT, Philander_Pielou)

pairwise.wilcox.test(Philander_Pielou$pielou_evenness, g = Philander_Pielou$HABITAT, p.adjust.method = "BH")

```

#Philander
##Region
###Figures
####Observed
```{r}

adiv_philander <- data.frame(estimate_richness(rpal_field_Philander, measures = "Observed"),
                   "Region" = phyloseq::sample_data(rpal_field_Philander)$Region)


adiv_philander_plot <- adiv_philander %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = reorder(Region, -value), y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,80) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 18)", "La Chorrera" = "La Chorrera\n(n = 51)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Region', y = "ASV Richness", fill = "Region") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot <- adiv_philander_plot + annotation_custom(figure_label_0.5)

#add sig figs

adiv_BM_plot +
  geom_text(data=tibble(x=c(1), y = 3.2), 
            aes(x=x, y=y, label = "a"), size = 3, #didelphis
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.2)), 
            aes(x=x, y=y, label = "b"), size = 3, #heteromy
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(3.2)), 
            aes(x=x, y=y, label = "c"), size = 3, #human
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(4), y = c(3.2)), 
            aes(x=x, y=y, label = "c,d,e"), size = 3, #mus
            inherit.aes = FALSE)  +
  geom_text(data=tibble(x=c(5), y = c(3.2)), 
            aes(x=x, y=y, label = "b,c,d,f"), size = 3, #piranga
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(6), y = c(3.2)), 
            aes(x=x, y=y, label = "e,f"), size = 3, #philander
            inherit.aes = FALSE) 

```

####Shannon
```{r}

adiv_philander <- data.frame(estimate_richness(rpal_field_Philander, measures = "Shannon"),
                   "Region" = phyloseq::sample_data(rpal_field_Philander)$Region)


adiv_philander_plot_shannon <- adiv_philander %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = reorder(Region, -value), y = value, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,2.5) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 18)", "La Chorrera" = "La Chorrera\n(n = 51)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Region', y = "Shannon Diversity", fill = "Region") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_shannon <- adiv_philander_plot_shannon + annotation_custom(figure_label_0.5)
```

####Faith PD
```{r}

adiv_philander_plot_Faith <- Philander_Faith %>%
  ggplot(aes(x = Region, y = faith_pd, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,13) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 18)", "La Chorrera" = "La Chorrera\n(n = 51)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = "Region", y = "Faith's Phylogenetic Diversity", fill = "Region") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_Faith <- adiv_philander_plot_Faith + annotation_custom(figure_label_0.5)
```

####Evenness
```{r}
adiv_philander_plot_pielou <- Philander_Pielou %>%
  ggplot(aes(x = Region, y = pielou_evenness, fill = Region)) +
  scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits = c("Capira", "La Chorrera"), labels=c("Capira" = "Capira\n(n = 18)", "La Chorrera" = "La Chorrera\n(n = 51)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Region', y = "Pielou's Evenness", fill = "Region") +
  guides(col = guide_legend("First BM")) +
  theme(legend.position = "none")

adiv_philander_plot_pielou <- adiv_philander_plot_pielou + annotation_custom(figure_label_0.5)
```

##Combined plots
```{r}
grid.arrange(adiv_philander_plot,adiv_philander_plot_pielou,adiv_philander_plot_shannon,adiv_philander_plot_Faith)
```


###ANOVA
```{r}
alpha.diversity <- estimate_richness(rpal_field_Philander, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field_Philander), alpha.diversity)


#Observed
kruskal.test(Observed ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg 


#Shannon 
kruskal.test(Shannon ~ Region, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg


#Faith's PD
kruskal.test(Philander_Faith$faith_pd ~ Region, Philander_Faith)

pairwise.wilcox.test(Philander_Faith$faith_pd, g = Philander_Faith$Region, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Philander_Pielou$pielou_evenness ~ Region, Philander_Pielou)

pairwise.wilcox.test(Philander_Pielou$pielou_evenness, g = Philander_Pielou$Region, p.adjust.method = "BH")

```

#Age Groups
#All samples
##Observed
```{r}

adiv_age <- data.frame(estimate_richness(rpal_field, measures = "Observed"),
                   "Age_Group" = phyloseq::sample_data(rpal_field)$Age_Group)

adiv_age_plot_richness <- adiv_age %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = Age_Group, y = value, fill = Age_Group)) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,100) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("N1_N3" = "N1 - N3\n(n = 192)", "N4_Adult" = "N4 - Adult\n(n = 91)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Age Groups', y = "Richness", title = "ASV Richness") +
  guides(col = guide_legend("Age Groups")) +
  theme(legend.position = "none")

#add sig figs

adiv_age_plot_richness <- adiv_age_plot_richness +
  geom_line(data=tibble(x=c(1, 2), y = c(80, 80)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(80, 78)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(80, 78)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(83)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) 

```

##Shannon
```{r}
adiv_age <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "Age_Group" = phyloseq::sample_data(rpal_field)$Age_Group)

adiv_age_plot_shannon <- adiv_age %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Age_Group, y = value, fill = Age_Group)) +
  #scale_fill_manual(values=cbPalette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("N1_N3" = "N1 - N3\n(n = 192)", "N4_Adult" = "N4 - Adult\n(n = 91)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Age Groups', y = "Shannon Diversity", title = "Shannon Diversity") +
  guides(col = guide_legend("Age Groups")) +
  theme(legend.position = "none")

#add sig figures and lines
adiv_age_plot_shannon <- adiv_age_plot_shannon +
  geom_line(data=tibble(x=c(1, 2), y = c(3, 3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.9, 3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.9, 3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.3)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, # p < 0.0001
            inherit.aes = FALSE) 

```


##Faith PD
```{r}

adiv_age_plot_Faith <- FaithPD %>%
  ggplot(aes(x = Age_Group, y = faith_pd, fill = Age_Group)) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,20) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("N1_N3" = "N1 - N3\n(n = 192)", "N4_Adult" = "N4 - Adult\n(n = 91)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = "Age Groups", y = "Faith's Phylogenetic diversity", title = "Faith's Phylogenetic Diversity") +
  theme(legend.position = "none")

adiv_age_plot_Faith <- adiv_age_plot_Faith +
  geom_line(data=tibble(x=c(1, 2), y = c(17, 17)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(17, 16.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(17, 16.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(18)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE)
```

##Evenness
```{r}
adiv_age_plot_pielou <- Pielous_Evenness %>%
  ggplot(aes(x = Age_Group, y = pielou_evenness, fill = Age_Group)) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,.8) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("N1_N3" = "N1 - N3\n(n = 192)", "N4_Adult" = "N4 - Adult\n(n = 91)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = "Age Groups", y = "Pielou's evenness", title = "Pielou's Evenness") +
  theme(legend.position = "none")

#add sig figures and lines
adiv_age_plot_pielou <- adiv_age_plot_pielou +
  #forest:pasture
  geom_line(data=tibble(x=c(1, 2), y = c(.75, .75)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(.75, .73)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(.75, .73)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "***"), size = 4, 
            inherit.aes = FALSE) 
```

##Combined plots
```{r}
grid.arrange(adiv_age_plot_richness,adiv_age_plot_pielou,adiv_age_plot_shannon,adiv_age_plot_Faith)
```



###ANOVA
Kruskal wallis (no pairwise needed for 2 groups)
This shows there is a difference between N1N3 and N4Adults
There is sig difference with Richness, Shannon, Chao
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)

kruskal.test(Observed ~ Age_Group, alphaRichness_data) #sig different
kruskal.test(Shannon ~ Age_Group, alphaRichness_data) # sig different


#pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Age_Group, p.adjust.method = "BH")

#pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Age_Group, p.adjust.method = "BH")


#Faith's PD
kruskal.test(FaithPD$faith_pd ~ Age_Group, FaithPD)

pairwise.wilcox.test(FaithPD$faith_pd, g = FaithPD$Age_Group, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness$pielou_evenness ~ Age_Group, Pielous_Evenness)

pairwise.wilcox.test(Pielous_Evenness$pielou_evenness, g = Pielous_Evenness$Age_Group, p.adjust.method = "BH")

```

##Region
####boxplots

```{r}
adiv_age <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "Age_Group" = phyloseq::sample_data(rpal_field)$Age_Group, "HABITAT" = phyloseq::sample_data(rpal_field)$HABITAT)



#adiv_infection <- data.frame(estimate_richness(rpal_field_SOVE_veraguas, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = #phyloseq::sample_data(rpal_field_SOVE_veraguas)$PCR_RESULTS_121_122, "HABITAT" = phyloseq::sample_data(rpal_field_SOVE_veraguas)$HABITAT)



adiv_age_plot <- adiv_age %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Age_Group, y = value, fill = Age_Group)) +
  facet_wrap(~HABITAT) +
  #scale_fill_manual(values=cbPalette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("N1_N3" = "N1 - N3\n(n = 192)", "N4_Adult" = "N4 - Adult\n(n = 91)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Age Groups', y = "Shannon Diversity", fill = "Age Groups") +
  guides(col = guide_legend("Age Groups"))
```

####ANOVA
```{r}
alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$Age_Group, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Age_Group, p.adjust.method = "BH")


#Faith's PD
kruskal.test(FaithPD$faith_pd ~ Age_Group, FaithPD)

pairwise.wilcox.test(FaithPD$faith_pd, g = FaithPD$Age_Group, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_Evenness$pielou_evenness ~ Age_Group, Pielous_Evenness)

pairwise.wilcox.test(Pielous_Evenness$pielou_evenness, g = Pielous_Evenness$Age_Group, p.adjust.method = "BH")
```


#NumberBM
##Observed
```{r}
adiv_NumBM_richness <- data.frame(estimate_richness(rpal_field_NumberBM, measures = "Observed"),
                   "NumberBM" = phyloseq::sample_data(rpal_field_NumberBM)$NumberBM)

adiv_NumBM_plot_richness <- adiv_NumBM_richness %>%
  gather(key = metric, value = value, "Observed") %>%
  mutate(metric = factor(metric, levels = "Observed")) %>%
  ggplot(aes(x = NumberBM, y = value, fill = NumberBM)) +
  #scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,101) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits=c("One", "Two", "Three", "Four"), labels=c("One" = "One\n(n = 78)", "Two" = "Two\n(n = 101)", "Three" = "Three\n(n = 74)", "Four" = "Four\n(n = 28)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Blood meal genera richness', y = "Richness", title = "ASV Richness") +
  guides(col = guide_legend("Blood meal genera richness")) +
  theme(legend.position = "none")

adiv_NumBM_plot_richness <- adiv_NumBM_plot_richness + 
  geom_text(data=tibble(x=c(1), y = c(80)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(80)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3, # p < 0.0001
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(80)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3,
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(4), y = c(80)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3,
            inherit.aes = FALSE)
```

##Shannon
```{r}

adiv_NumBM_shannon <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "NumberBM" = phyloseq::sample_data(rpal_field)$NumberBM)

adiv_NumBM_plot_shannon <- adiv_NumBM_shannon %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = NumberBM, y = value, fill = NumberBM)) +
  #scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits=c("One", "Two", "Three", "Four"), labels=c("One" = "One\n(n = 78)", "Two" = "Two\n(n = 101)", "Three" = "Three\n(n = 74)", "Four" = "Four\n(n = 28)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Blood meal genera richness', y = "Shannon Diversity", title = "Shannon Diversity") +
  guides(col = guide_legend("Blood meal genera richness")) +
  theme(legend.position = "none")


#add sig figures and lines
adiv_NumBM_plot_shannon <- adiv_NumBM_plot_shannon +
  geom_text(data=tibble(x=c(1), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ab"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "b"), size = 3, # p < 0.0001
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ac"), size = 3,
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(4), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "abc"), size = 3,
            inherit.aes = FALSE)

```

##Faith
```{r}
adiv_Number_plot_Faith <- Faith_BM %>%
  ggplot(aes(x = NumberBM, y = faith_pd, fill = NumberBM)) +
  #scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,20) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits=c("One", "Two", "Three", "Four"), labels=c("One" = "One\n(n = 78)", "Two" = "Two\n(n = 101)", "Three" = "Three\n(n = 74)", "Four" = "Four\n(n = 28)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = "Blood meal genera richness", y = "Faith's Phylogenetic Diversity", title = "Faith's Phylogenetic Diversity") +
  theme(legend.position = "none")


adiv_Number_plot_Faith <- adiv_Number_plot_Faith +
  geom_text(data=tibble(x=c(1), y = c(18)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(18)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3, # p < 0.0001
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(18)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3,
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(4), y = c(18)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3,
            inherit.aes = FALSE)

```

##Pielou
```{r}
adiv_number_plot_pielou <- Pielous_BM %>%
  ggplot(aes(x = NumberBM, y = pielou_evenness, fill = NumberBM)) +
  #scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,1) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(limits=c("One", "Two", "Three", "Four"), labels=c("One" = "One\n(n = 78)", "Two" = "Two\n(n = 101)", "Three" = "Three\n(n = 74)", "Four" = "Four\n(n = 28)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Blood meal genera richness', y = "Pielou's Evenness", title = "Pielou's Evenness") +
  theme(legend.position = "none")

adiv_number_plot_pielou <- adiv_number_plot_pielou +
  geom_text(data=tibble(x=c(1), y = c(.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "a"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "b"), size = 3, # p < 0.0001
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(3), y = c(.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ab"), size = 3,
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(4), y = c(.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ab"), size = 3,
            inherit.aes = FALSE)
```

##Combined
```{r}
grid.arrange(adiv_NumBM_plot_richness, adiv_Number_plot_Faith, adiv_NumBM_plot_shannon, adiv_number_plot_pielou)
```


###ANOVA
Stats information 
- Wilcoxon test (compares two groups - non parametric)
-kruskal wallis (compares multiple groups non parametric)


```{r}

alpha.diversity <- estimate_richness(rpal_field_NumberBM, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_NumberBM), alpha.diversity)


#Observed
kruskal.test(Observed ~ NumberBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$NumberBM, p.adjust.method = "BH") #Benjamini & Hochberg



#Shannon 
kruskal.test(Shannon ~ NumberBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$NumberBM, p.adjust.method = "BH") #Benjamini & Hochberg

#Faith's PD
kruskal.test(Faith_BM$faith_pd ~ NumberBM, Faith_BM)

pairwise.wilcox.test(Faith_BM$faith_pd, g = Faith_BM$NumberBM, p.adjust.method = "BH")

#Pielou's evennes
kruskal.test(Pielous_BM$pielou_evenness ~ NumberBM, Pielous_BM)

pairwise.wilcox.test(Pielous_BM$pielou_evenness, g = Pielous_BM$NumberBM, p.adjust.method = "BH")


```

##TypeBM
```{r}

adiv_TypeBM <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "TypeBM" = phyloseq::sample_data(rpal_field)$TypeBM)

adiv_TypeBM_plot <- adiv_TypeBM %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = TypeBM, y = value, fill = TypeBM)) +
  #scale_fill_manual(values=cbPalette_regions) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Reptile" = "Herps\n(n = 1)", "Bird" = "Birds\n(n = 10)", "Mammal" = "Mammals\n(n = 233)", "Other" = "Other\n(n = 17)", "Mix" = "Mix\n(n = 50)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Type BM', y = "Shannon Diversity", fill = "Blood meal")


#add sig figures and lines
adiv_regions_plot +
  geom_line(data=tibble(x=c(2,3), y = c(2.6, 2.6)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.6)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.5, 2.6)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p = 0.045"), size = 3, # p < 0.05
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3.3, 3.3)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.2, 3.3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2.5), y = c(3.5)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p < 0.0001"), size = 3, # p < 0.0001
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.7, 3.7)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.6, 3.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.6, 3.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.9)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p < 0.0001"), size = 3,
            inherit.aes = FALSE) # < 0.0001

```

###ANOVA
Stats information 
- Wilcoxon test (compares two groups - non parametric)
-kruskal wallis (compares multiple groups non parametric)
```{r}
alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Shannon", "Chao1", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Observed
kruskal.test(Observed ~ TypeBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$TypeBM, p.adjust.method = "BH") #Benjamini & Hochberg



#Shannon 
kruskal.test(Shannon ~ TypeBM, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

#Chao1
kruskal.test(Chao1 ~ Region, alphaRichness_data)
pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
kruskal.test(InvSimpson ~ Region, alphaRichness_data)
pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg

```




##Estadio
```{r}
adiv_age <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "Age_Group" = phyloseq::sample_data(rpal_field)$Age_Group)

adiv_age_plot <- adiv_age %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = Age_Group, y = value, fill = Age_Group)) +
  #scale_fill_manual(values=cbPalette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Adult" = "Adult\n(n = 61)", "N1" = "N1\n(n = 74)", "N2" = "N2\n(n = 60)", "N3" = "N3\n(n = 62)", 
                            "N4" = "N4\n(n = 17)", "N5" = "N5\n(n = 27)")) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(x = 'Instars', y = "Shannon Diversity", fill = "Age Groups") +
  guides(col = guide_legend("Instars"))

adiv_age_plot
```

###ANOVA
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed","Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)

#Observed
#Shannon 
kruskal.test(Observed ~ Age_Group, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 

#Shannon 
kruskal.test(Shannon ~ Age_Group, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Age_Group, p.adjust.method = "BH") #Benjamini & Hochberg 

#Chao1
kruskal.test(Chao1 ~ , alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 

#InvSimpson Richness
kruskal.test(InvSimpson ~ ESTADIO, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 
```

#Tcruzi


#T cruzi positive
```{r}
adiv_infection_veraguas <- data.frame(estimate_richness(rpal_infection_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_infection_veraguas)$HABITAT)



adiv_infection_veraguas_plot <- adiv_infection_veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  #facet_grid(~Region, scales = "free") +
  #scale_fill_manual(values=cbPalette_infection) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Positive" = "Positive\n(n = 131)", "Negative" = "Negative\n(n = 157)", "Tcruzi" = "T. cruzi\n(n = 33)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity")

#add sig figures and lines
#adiv_infection_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.8, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p = 0.097"), size = 3, 
            inherit.aes = FALSE) +

  geom_line(data=tibble(x=c(2, 3), y = c(2.8, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p = 0.097"), size = 3, 
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(2.8, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p = 0.097"), size = 3, 
            inherit.aes = FALSE) 

```

#Veraguas
```{r}


adiv_infection <- data.frame(estimate_richness(rpal_field_SOVE_veraguas, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_SOVE_veraguas)$PCR_RESULTS_121_122, "HABITAT" = phyloseq::sample_data(rpal_field_SOVE_veraguas)$HABITAT)



adiv_infection_plot <- adiv_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  facet_grid(~HABITAT, scales = "free") +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  #scale_x_discrete(labels=c("Coinfection" = "Coinfection\n(n = 11)", "Negative" = "Negative\n(n = 157)", "Positive" = "Positive\n(n = 131)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity", title = "Alpha Diversity Across Veraguas Samples")
```

#Infection
##ANOVA
###Positive
This is only positive tcruzi samples across all sampling regions
```{r}
alpha.diversity <- estimate_richness(rpal_infection, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_infection), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_Tcruzi$faith_pd ~ HABITAT, FaithPD_Tcruzi)

pairwise.wilcox.test(FaithPD_Tcruzi$faith_pd, g = FaithPD_Tcruzi$HABITAT, p.adjust.method = "BH")
```


This is only negative samples across all sampling regions
```{r}
alpha.diversity <- estimate_richness(rpal_negative, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_negative), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_negative$faith_pd ~ HABITAT, FaithPD_negative)

pairwise.wilcox.test(FaithPD_negative$faith_pd, g = FaithPD_negative$HABITAT, p.adjust.method = "BH")
```
####Veraguas 
#####Positive
This is only positive tcruzi samples in veraguas
```{r}
alpha.diversity <- estimate_richness(rpal_infection_veraguas, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_infection_veraguas), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_veraguas_tcruzi$faith_pd ~ HABITAT, FaithPD_veraguas_tcruzi)

pairwise.wilcox.test(FaithPD_veraguas_tcruzi$faith_pd, g = FaithPD_veraguas_tcruzi$HABITAT, p.adjust.method = "BH")
```

#####Negative
```{r}
alpha.diversity <- estimate_richness(rpal_negative_veraguas, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_negative_veraguas), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_veraguas_negative$faith_pd ~ HABITAT, FaithPD_veraguas_negative)

pairwise.wilcox.test(FaithPD_veraguas_negative$faith_pd, g = FaithPD_veraguas_negative$HABITAT, p.adjust.method = "BH")
```

####Capira
#####Positive
```{r}
alpha.diversity <- estimate_richness(rpal_infection_capira, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_infection_capira), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_capira_tcruzi$faith_pd ~ HABITAT, FaithPD_capira_tcruzi)

```

#####Negative
```{r}
alpha.diversity <- estimate_richness(rpal_negative_capira, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_negative_capira), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_capira_negative$faith_pd ~ HABITAT, FaithPD_capira_negative)

```

###chorrera
####Postive
```{r}
alpha.diversity <- estimate_richness(rpal_infection_chorrera, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_infection_chorrera), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_chorrera_tcruzi$faith_pd ~ HABITAT, FaithPD_chorrera_tcruzi)

pairwise.wilcox.test(FaithPD_chorrera_tcruzi$faith_pd, g = FaithPD_chorrera_tcruzi$HABITAT, p.adjust.method = "BH")
```

####Negative
```{r}
alpha.diversity <- estimate_richness(rpal_negative_chorrera, measures = c("Observed", "Shannon"))

alphaRichness_data <- cbind(sample_data(rpal_negative_chorrera), alpha.diversity)


pairwise.wilcox.test(alphaRichness_data$Observed, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH")

#Faith's PD
kruskal.test(FaithPD_chorrera_negative$faith_pd ~ HABITAT, FaithPD_chorrera_negative)

pairwise.wilcox.test(FaithPD_chorrera_negative$faith_pd, g = FaithPD_chorrera_negative$HABITAT, p.adjust.method = "BH")
```



##T cruzi - canal
This is 121_122 data - includes coinfections
```{r}
adiv_infection <- data.frame(estimate_richness(rpal_field_Tcruzi_canal, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_Tcruzi_canal)$PCR_RESULTS_121_122)



adiv_infection_plot <- adiv_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Positive" = "Positive\n(n = 63)", "Negative" = "Negative\n(n = 121)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity")

#add sig figures and lines
adiv_infection_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.6, 2.6)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.6, 2.5)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.6, 2.5)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.8)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.0001
            inherit.aes = FALSE) 

```


##T cruzi - canal
This is 121_122 data - includes coinfections
```{r}
adiv_infection <- data.frame(estimate_richness(rpal_field_Tcruzi_canal, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_Tcruzi_canal)$PCR_RESULTS_121_122)



adiv_infection_plot <- adiv_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  facet_grid(~HABITAT, scales = "free") +
  #scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Positive" = "Positive\n(n = 136)", "Negative" = "Negative\n(n = 164)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity")

#add sig figures and lines
adiv_infection_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.2, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p < 0.0001"), size = 3, # p < 0.0001
            inherit.aes = FALSE) 

```


##T cruzi - veraguas
This is 121_122 data - includes coinfections
```{r}
adiv_infection <- data.frame(estimate_richness(rpal_field_Tcruzi_veraguas, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_Tcruzi_veraguas)$PCR_RESULTS_121_122)



adiv_infection_plot <- adiv_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=c("#999999", "#D55E00")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Positive" = "Positive\n(n = 73)", "Negative" = "Negative\n(n = 43)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity")

#add sig figures and lines
adiv_infection_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.2, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 5, # p < 0.0001
            inherit.aes = FALSE) 

```

###ANOVA veraguas
Tcruzi infections including coinfections
```{r}
## all diversity measures are significantly different

alpha.diversity <- estimate_richness(rpal_field_Tcruzi_veraguas, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_Tcruzi_veraguas), alpha.diversity)


#Shannon 
kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)
```


##T cruzi - veraguas forest
This is 121_122 data - includes coinfections
```{r}
adiv_infection <- data.frame(estimate_richness(rpal_field_Tcruzi_veraguas_forest, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_Tcruzi_veraguas_forest)$PCR_RESULTS_121_122)

adiv_infection_plot <- adiv_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=c("#999999", "#D55E00")) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Positive" = "Positive\n(n = 6)", "Negative" = "Negative\n(n = 22)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Infection Status', y = "Shannon Diversity")

#add sig figures and lines
adiv_infection_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.9, 2.9)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.9, 2.8)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.9, 2.8)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.1)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "p = 0.09"), size = 3, # p < 0.0001
            inherit.aes = FALSE) 

```


###ANOVA
Tcruzi infections including coinfections
```{r}
## all diversity measures are significantly different

alpha.diversity <- estimate_richness(rpal_field_Tcruzi_veraguas_forest, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_Tcruzi_veraguas_forest), alpha.diversity)


#Shannon 
kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)
```

##Bloodmeal - mammal vs non mammal
```{r}

adiv_mammalBM <- data.frame(estimate_richness(rpal_field, measures = "Shannon"),
                   "MammalBM" = phyloseq::sample_data(rpal_field)$MammalBM)



adiv_mammalBM_plot <- adiv_mammalBM %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = MammalBM, y = value, fill = MammalBM)) +
  scale_fill_manual(values=cbPalette) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.5) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  #scale_x_discrete(labels=c("Positive" = "Positive\n(n = 136)", "Negative" = "Negative\n(n = 164)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "MammalBM") +
  labs(x = 'MammalBM', y = "Shannon Diversity")

#add sig figures and lines
adiv_mammalBM_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.2, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 3, # p < 0.0001
            inherit.aes = FALSE) 



```

###ANOVA
```{r}
## no difference

alpha.diversity <- estimate_richness(rpal_field, measures = c("Observed", "Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Observed richness
kruskal.test(Observed ~ NumberBM, alphaRichness_data)


#Shannon 
kruskal.test(Shannon ~ NumberBM, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ NumberBM, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ NumberBM, alphaRichness_data)
```


#Across Age Groups
##Habitat
All field samples across habitat, split by region
```{r}

adiv_N1_N3 <- data.frame(estimate_richness(rpal_field_N1N3, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N1N3)$HABITAT)


adiv_N4_Adult <- data.frame(estimate_richness(rpal_field_N4Adult, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult)$HABITAT)


adiv_N1_N3_plot <- adiv_N1_N3 %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.8) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Forest" = "Forest \n(n = 14)", "Pasture" = "Pasture \n(n = 114)", "Peridomestic" = "Peridomestic \n(n = 68)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'N1 - N3', y = "Shannon Diversity") +
  theme(legend.position="none")

adiv_N1_N3_plot <- adiv_N1_N3_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3, 3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.9, 3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.9, 3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # p < 0.05
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(2.7, 2.7)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.6, 2.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.6, 2.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.5, 3.5)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.5, 3.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.5, 3.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6,
            inherit.aes = FALSE) # < 0.0001

#####

adiv_N4_Adult_plot <- adiv_N4_Adult %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3.8) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Forest" = "Forest \n(n = 14)", "Pasture" = "Pasture \n(n = 50)", "Peridomestic" = "Peridomestic \n(n = 41)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'N4 - Adult', y = "Shannon Diversity")

adiv_N4_Adult_plot <- adiv_N4_Adult_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3, 3)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.9, 3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.9, 3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.2)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # p < 0.05
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(2.7, 2.7)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.6, 2.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(2.6, 2.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.5, 3.5)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.5, 3.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.5, 3.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(3.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6,
            inherit.aes = FALSE) # < 0.0001


grid.arrange(adiv_N1_N3_plot,adiv_N4_Adult_plot, ncol = 2)

```


###ANOVA
Tcruzi infections including coinfections
```{r}
## all diversity measures are significantly different for N1 N3, but not different for N4 to adult

#### N1 N3
alpha.diversity <- estimate_richness(rpal_field_N1N3, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_N1N3), alpha.diversity)


#Shannon 
HABITAT.KW.shannon <- kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Chao1
HABITAT.KW.Chao <- kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
HABITAT.KW.InvSimpson <- kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#### N4 Adult 

alpha.diversity <- estimate_richness(rpal_field_N4Adult, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_N4Adult), alpha.diversity)


#Shannon 
HABITAT.KW.shannon <- kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#Chao1
HABITAT.KW.Chao <- kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg


#InvSimpson Richness
HABITAT.KW.InvSimpson <- kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg
```

##T cruzi
All field samples across T cruzi, split by age groups --- gotta update to correct everything
```{r}

rpal_field_N1N3_filtered <- subset_samples(rpal_field_N1N3, PCR_RESULTS_121_122 != "NA") #this will remove the one NA sample

adiv_N1_N3 <- data.frame(estimate_richness(rpal_field_N1N3_filtered, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N1N3_filtered)$PCR_RESULTS_121_122)


adiv_N4_Adult <- data.frame(estimate_richness(rpal_field_N4Adult, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N4Adult)$PCR_RESULTS_121_122)



adiv_N1_N3_plot <- adiv_N1_N3 %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,4) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Negative" = "Negative \n(n = 141)", "Positive" = "Postiive \n(n = 54)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "T. cruzi Infection") +
  labs(x = 'N1 - N3', y = "Shannon Diversity") +
  theme(legend.position="none")

#add sig figures and lines

adiv_N1_N3_plot <- adiv_N1_N3_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.2, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # p < 0.0001
            inherit.aes = FALSE) 


### N4 Adults
adiv_N4_Adult_plot <- adiv_N4_Adult %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_infection_single) +
  ylim(0,4) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Negative" = "Negative \n(n = 23)", "Positive" = "Postiive \n(n = 82)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "T. cruzi Infection") +
  labs(x = 'N4 - Adult', y = "Shannon Diversity")

## add sig figs

adiv_N4_Adult_plot <- adiv_N4_Adult_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.2, 3.2)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4, # p < 0.0001
            inherit.aes = FALSE) 


grid.arrange(adiv_N1_N3_plot,adiv_N4_Adult_plot, ncol = 2)

```


###ANOVA
Tcruzi infections including coinfections
```{r}
## all diversity measures are significantly different for N1 N3, but not different for N4 to adult

#### N1 N3
alpha.diversity <- estimate_richness(rpal_field_N1N3_filtered, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_N1N3_filtered), alpha.diversity)


#Shannon 
tcruzi.KW.shannon <- kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.shannon

#Chao1
tcruzi.KW.Chao <- kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.Chao

#InvSimpson Richness
tcruzi.KW.InvSimpson <- kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.InvSimpson

#### N4 Adult 

alpha.diversity <- estimate_richness(rpal_field_N4Adult, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_N4Adult), alpha.diversity)


#Shannon 
tcruzi.KW.shannon <- kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.shannon

#Chao1
tcruzi.KW.Chao <- kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.Chao

#InvSimpson Richness
tcruzi.KW.InvSimpson <- kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)
tcruzi.KW.InvSimpson


```

#Across Region
##Habitat
This (these?) plot(s) is habitat type split across regions
```{r}

adiv_canal <- data.frame(estimate_richness(rpal_field_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_canal)$HABITAT)


adiv_veraguas <- data.frame(estimate_richness(rpal_field_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_veraguas)$HABITAT)


adiv_canal_plot <- adiv_canal %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat_canal) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Pasture" = "Pasture \n(n = 113)", "Peridomestic" = "Peridomestic \n(n = 71)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")

## add sig figs

adiv_canal_plot <- adiv_canal_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.5, 2.5)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.5, 2.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4, # not significant
            inherit.aes = FALSE)
######

adiv_veraguas_plot <- adiv_veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_habitat_veraguas) +
  ylim(0,4) +
  theme_bw() +
  scale_x_discrete(labels=c("Forest" = "Forest \n(n = 24)", "Pasture" = "Pasture \n(n = 47)", "Peridomestic" = "Peridomestic \n(n = 35)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")


adiv_veraguas_plot <- adiv_veraguas_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.4, 3.4)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.4, 3.3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.4, 3.3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.6)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # not significant
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3.2, 3.2)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
   geom_text(data=tibble(x=c(2.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.8, 3.8)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.8, 3.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.8, 3.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6,
            inherit.aes = FALSE) # < 0.0001


grid.arrange(adiv_canal_plot,adiv_veraguas_plot, ncol = 2)

```

##T cruzi
```{r}

##need to fix colors so that forest is the only green
adiv_canal <- data.frame(estimate_richness(rpal_field_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_canal)$HABITAT)


adiv_veraguas <- data.frame(estimate_richness(rpal_field_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_veraguas)$HABITAT)


adiv_canal_plot <- adiv_canal %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Pasture" = "Pasture (n = 113)", "Peridomestic" = "Peridomestic (n = 71)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")


adiv_veraguas_plot <- adiv_veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_habitat) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Forest" = "Forest (n = 24)", "Pasture" = "Pasture (n = 47)", "Peridomestic" = "Peridomestic (n = 35)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")

grid.arrange(adiv_canal_plot,adiv_veraguas_plot, ncol = 2)

```

The below plots are split by region and age


#Region N1_N3
##Habitat
```{r}
rpal_field_N1N3_canal <- data.frame(estimate_richness(rpal_field_N1N3_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N1N3_canal)$HABITAT)


rpal_field_N1N3_veraguas <- data.frame(estimate_richness(rpal_field_N1N3_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N1N3_veraguas)$HABITAT)


adiv_canal_plot <- adiv_canal %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat_canal) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture \n(n = 83)", "Peridomestic" = "Peridomestic \n(n = 52)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")

## add sig figs

adiv_canal_plot <- adiv_canal_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.5, 2.5)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.5, 2.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4, # not significant
            inherit.aes = FALSE)
######

adiv_veraguas_plot <- adiv_veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_habitat_veraguas) +
  ylim(0,4) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Forest" = "Forest \n(n = 14)", "Pasture" = "Pasture \n(n = 31)", "Peridomestic" = "Peridomestic \n(n = 16)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")


adiv_veraguas_plot <- adiv_veraguas_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.4, 3.4)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.4, 3.3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.4, 3.3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.6)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # not significant
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3.2, 3.2)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
   geom_text(data=tibble(x=c(2.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.8, 3.8)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.8, 3.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.8, 3.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6,
            inherit.aes = FALSE) # < 0.0001


grid.arrange(adiv_canal_plot,adiv_veraguas_plot, ncol = 2)

```


## Infection
```{r}
##filter out NA samples

rpal_field_N1N3_canal_infections <- subset_samples(rpal_field_N1N3_canal, PCR_RESULTS_121_122 != "NA") ## removes single NA infection result

rpal_field_N1N3_veraguas_infections <- subset_samples(rpal_field_N1N3_veraguas, PCR_RESULTS_121_122 != "NA") ## removes single NA infection result

######

adiv_canal_infection <- data.frame(estimate_richness(rpal_field_N1N3_canal_infections, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N1N3_canal_infections)$PCR_RESULTS_121_122)


adiv_veraguas_infection <- data.frame(estimate_richness(rpal_field_N1N3_veraguas_infections, measures = "Shannon"),
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N1N3_veraguas_infections)$PCR_RESULTS_121_122)


adiv_canal_infection_plot <- adiv_canal_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  #scale_x_discrete(labels=c("Pasture" = "Pasture (n = 113)", "Peridomestic" = "Peridomestic (n = 71)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Canal', y = "Shannon Diversity")



adiv_veraguas_infection_plot <- adiv_veraguas_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = PCR_RESULTS_121_122)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_infection_single) +
  ylim(0,3) +
  theme_bw() +
  #scale_x_discrete(labels=c("Forest" = "Forest (n = 24)", "Pasture" = "Pasture (n = 47)", "Peridomestic" = "Peridomestic (n = 35)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Veraguas', y = "Shannon Diversity")

grid.arrange(adiv_canal_infection_plot,adiv_veraguas_infection_plot, ncol = 2)

```


#Region N4_Adult
##Habitat
```{r}
rpal_field_N4Adult_canal <- data.frame(estimate_richness(rpal_field_N4Adult_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_canal)$HABITAT)


rpal_field_N4Adult_veraguas <- data.frame(estimate_richness(rpal_field_N4Adult_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$HABITAT)


adiv_canal_plot <- adiv_canal %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat_canal) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Pasture" = "Pasture \n(n = 30)", "Peridomestic" = "Peridomestic \n(n = 20)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")

## add sig figs

adiv_canal_plot <- adiv_canal_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(2.5, 2.5)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(2.5, 2.4)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(2.5, 2.4)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(2.7)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4, # not significant
            inherit.aes = FALSE)
######

adiv_veraguas_plot <- adiv_veraguas %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = HABITAT)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_habitat_veraguas) +
  ylim(0,4) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  scale_x_discrete(labels=c("Forest" = "Forest \n(n = 14)", "Pasture" = "Pasture \n(n = 20)", "Peridomestic" = "Peridomestic \n(n = 21)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Habitat Type', y = "Shannon Diversity")


adiv_veraguas_plot <- adiv_veraguas_plot +
  geom_line(data=tibble(x=c(1, 2), y = c(3.4, 3.4)), #horizontal line
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.4, 3.3)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.4, 3.3)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(1.5), y = c(3.6)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6, # not significant
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 3), y = c(3.2, 3.2)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(2, 2), y = c(3.2, 3.1)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.2, 3.1)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
   geom_text(data=tibble(x=c(2.5), y = c(3.4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "ns"), size = 4,
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 3), y = c(3.8, 3.8)), #horizontal
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(1, 1), y = c(3.8, 3.7)), #vertical left
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_line(data=tibble(x=c(3, 3), y = c(3.8, 3.7)), #vertical right
            aes(x=x, y=y),
            inherit.aes = FALSE) +
  geom_text(data=tibble(x=c(2), y = c(4)), #text (.2 higher than the line)
            aes(x=x, y=y, label = "**"), size = 6,
            inherit.aes = FALSE) # < 0.0001


grid.arrange(adiv_canal_plot,adiv_veraguas_plot, ncol = 2)

```

## Infection
```{r}

adiv_canal_infection <- data.frame(estimate_richness(rpal_field_N4Adult_canal, measures = "Shannon"),
                   "SingleInf_Tcruzi" = phyloseq::sample_data(rpal_field_N4Adult_canal)$SingleInf_Tcruzi)


adiv_veraguas_infection <- data.frame(estimate_richness(rpal_field_N4Adult_veraguas, measures = "Shannon"),
                   "SingleInf_Tcruzi" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$SingleInf_Tcruzi)


adiv_canal_infection_plot <- adiv_canal_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = SingleInf_Tcruzi, y = value, fill = SingleInf_Tcruzi)) +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Negative" = "Negative \n(n = 17)", "Positive" = "Positive \n(n = 33)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Canal', y = "Shannon Diversity")



adiv_veraguas_infection_plot <- adiv_veraguas_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = SingleInf_Tcruzi, y = value, fill = SingleInf_Tcruzi)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_infection_single) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Negative" = "Negative \n(n = 6)", "Positive" = "Positive \n(n = 49)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Veraguas', y = "Shannon Diversity")

grid.arrange(adiv_canal_infection_plot,adiv_veraguas_infection_plot, ncol = 2)

```

##Infection across habitat type
```{r}

adiv_canal_habitat_infection <- data.frame(estimate_richness(rpal_field_N4Adult_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_canal)$HABITAT,
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N4Adult_canal)$PCR_RESULTS_121_122)


adiv_veraguas_habitat_infection <- data.frame(estimate_richness(rpal_field_N4Adult_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$HABITAT,
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$PCR_RESULTS_121_122)


adiv_canal_habitat_infection_plot <- adiv_canal_habitat_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = PCR_RESULTS_121_122)) +
  scale_fill_manual(values=cbPalette_infection_single) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Pasture" = "Pasture \n(n = 113)", "Peridomestic" = "Peridomestic \n(n = 71)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Canal', y = "Shannon Diversity")


adiv_veraguas_habitat_infection_plot <- adiv_veraguas_habitat_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = HABITAT, y = value, fill = PCR_RESULTS_121_122)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_infection_single) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Forest" = "Forest (n = 24)", "Pasture" = "Pasture (n = 47)", "Peridomestic" = "Peridomestic (n = 35)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Infection Status") +
  labs(x = 'Veraguas', y = "Shannon Diversity")

grid.arrange(adiv_canal_habitat_infection_plot,adiv_veraguas_habitat_infection_plot, ncol = 2)

```

##Region - Habitat Across Infection
```{r}

adiv_canal_habitat_infection <- data.frame(estimate_richness(rpal_field_N4Adult_canal, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_canal)$HABITAT,
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N4Adult_canal)$PCR_RESULTS_121_122)


adiv_veraguas_habitat_infection <- data.frame(estimate_richness(rpal_field_N4Adult_veraguas, measures = "Shannon"),
                   "HABITAT" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$HABITAT,
                   "PCR_RESULTS_121_122" = phyloseq::sample_data(rpal_field_N4Adult_veraguas)$PCR_RESULTS_121_122)


adiv_canal_habitat_infection_plot <- adiv_canal_habitat_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = HABITAT)) +
  scale_fill_manual(values=cbPalette_habitat) +
  geom_boxplot(outlier.color = NA) +
  ylim(0,3) +
  theme_bw() +
  #scale_x_discrete(labels=c("Pasture" = "Pasture (n = 113)", "Peridomestic" = "Peridomestic (n = 71)")) + ##change to add sample sizes of infections
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Canal', y = "Shannon Diversity")


adiv_veraguas_habitat_infection_plot <- adiv_veraguas_habitat_infection %>%
  gather(key = metric, value = value, "Shannon") %>%
  mutate(metric = factor(metric, levels = "Shannon")) %>%
  ggplot(aes(x = PCR_RESULTS_121_122, y = value, fill = HABITAT)) +
  geom_boxplot(outlier.color = NA) +
  scale_fill_manual(values=cbPalette_habitat) +
  ylim(0,3) +
  theme_bw() +
  scale_x_discrete(labels=c("Forest" = "Forest (n = 24)", "Pasture" = "Pasture (n = 47)", "Peridomestic" = "Peridomestic (n = 35)")) +
  theme(plot.title = element_text(size = 14, hjust = 0.5, face = "bold")) +
  labs(fill = "Habitat Type") +
  labs(x = 'Veraguas', y = "Shannon Diversity")

grid.arrange(adiv_canal_habitat_infection_plot,adiv_veraguas_habitat_infection_plot, ncol = 2)

```


This is a section to combine all ANOVA analyses together in one section
#ANOVA
##Estadio
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Shannon 
kruskal.test(Shannon ~ ESTADIO, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 

#Chao1
kruskal.test(Chao1 ~ ESTADIO, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 

#InvSimpson Richness
kruskal.test(InvSimpson ~ ESTADIO, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$ESTADIO, p.adjust.method = "BH") #Benjamini & Hochberg 
```

##Age Groups
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Shannon 
kruskal.test(Shannon ~ Age_Group, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ Age_Group, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ Age_Group, alphaRichness_data)

```


##Regions (Capira, La Chorrera, Veraguas)
```{r}

alpha.diversity <- estimate_richness(rpal_field, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field), alpha.diversity)


#Shannon 
Region.KW.shannon <- kruskal.test(Shannon ~ Region, alphaRichness_data)
Region.KW.shannon ## significant

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg 


#Chao1
Region.KW.Chao <- kruskal.test(Chao1 ~ Region, alphaRichness_data)
Region.KW.Chao ## significant -- 0.045 between La Chorrera and Capira

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg 


#InvSimpson Richness
Region.KW.InvSimpson <- kruskal.test(InvSimpson ~ Region, alphaRichness_data)
Region.KW.InvSimpson ## significant

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$Region, p.adjust.method = "BH") #Benjamini & Hochberg 
```


##Capira
###Habitat Type 
use Kruskal wallis for non-normal data
```{r echo=FALSE}
alpha.diversity <- estimate_richness(rpal_field_capira, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_capira), alpha.diversity)

#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)


#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

```

Capira
###Single T cruzi Infection
use Kruskal wallis for non-normal data
```{r echo=FALSE}
alpha.diversity <- estimate_richness(rpal_field_capira, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_capira), alpha.diversity)

#Shannon 
kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)


#InvSimpson Richness
kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)

```

##La Chorrera
###Habitat Type 
use Kruskal wallis for non-normal data
```{r echo=FALSE}
alpha.diversity <- estimate_richness(rpal_field_laChorrera, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_laChorrera), alpha.diversity)

#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

```

###T cruzi Infection
La Chorrera
use Kruskal wallis for non-normal data
```{r echo=FALSE}
alpha.diversity <- estimate_richness(rpal_field_laChorrera, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_laChorrera), alpha.diversity)

#Shannon 
kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)

```

##Veraguas
###Habitat
```{r echo=FALSE}

alpha.diversity <- estimate_richness(rpal_field_veraguas, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_veraguas), alpha.diversity)


#Shannon 
kruskal.test(Shannon ~ HABITAT, alphaRichness_data) ## significant

pairwise.wilcox.test(alphaRichness_data$Shannon, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 

#Chao1
kruskal.test(Chao1 ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$Chao1, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 


#InvSimpson Richness
kruskal.test(InvSimpson ~ HABITAT, alphaRichness_data)

pairwise.wilcox.test(alphaRichness_data$InvSimpson, g = alphaRichness_data$HABITAT, p.adjust.method = "BH") #Benjamini & Hochberg 
```

###T cruzi
```{r}

alpha.diversity <- estimate_richness(rpal_field_veraguas, measures = c("Chao1", "Shannon", "InvSimpson"))

alphaRichness_data <- cbind(sample_data(rpal_field_veraguas), alpha.diversity)

#Shannon 
kruskal.test(Shannon ~ PCR_RESULTS_121_122, alphaRichness_data)

#Chao1
kruskal.test(Chao1 ~ PCR_RESULTS_121_122, alphaRichness_data)

#InvSimpson Richness
kruskal.test(InvSimpson ~ PCR_RESULTS_121_122, alphaRichness_data)
```

